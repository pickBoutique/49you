var xd=function(){var n,o,p,s;function K(a,b){var c=document.createElement("script");c.type="text/javascript";c.async=true;var e=false;c.onreadystatechange=function(){if((this.readyState=="loaded"||this.readyState=="complete")&&!e)e=true,b()};c.onload=b;c.src=a;var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}function h(a,b){return{valid:a,msg:b}}function L(a){var b;b=[];b=a.split("");if({11:"\u5317\u4eac",12:"\u5929\u6d25",13:"\u6cb3\u5317",14:"\u5c71\u897f",15:"\u5185\u8499\u53e4",
21:"\u8fbd\u5b81",22:"\u5409\u6797",23:"\u9ed1\u9f99\u6c5f",31:"\u4e0a\u6d77",32:"\u6c5f\u82cf",33:"\u6d59\u6c5f",34:"\u5b89\u5fbd",35:"\u798f\u5efa",36:"\u6c5f\u897f",37:"\u5c71\u4e1c",41:"\u6cb3\u5357",42:"\u6e56\u5317",43:"\u6e56\u5357",44:"\u5e7f\u4e1c",45:"\u5e7f\u897f",46:"\u6d77\u5357",50:"\u91cd\u5e86",51:"\u56db\u5ddd",52:"\u8d35\u5dde",53:"\u4e91\u5357",54:"\u897f\u85cf",61:"\u9655\u897f",62:"\u7518\u8083",63:"\u9752\u6d77",64:"\u5b81\u590f",65:"\u65b0\u7586",71:"\u53f0\u6e7e",81:"\u9999\u6e2f",
82:"\u6fb3\u95e8",91:"\u56fd\u5916"}[parseInt(a.substr(0,2))]==null)return false;switch(a.length){case 15:return ereg=(parseInt(a.substr(6,2))+1900)%4==0||(parseInt(a.substr(6,2))+1900)%100==0&&(parseInt(a.substr(6,2))+1900)%4==0?/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,
ereg.test(a)?true:false;case 18:return ereg=parseInt(a.substr(6,4))%4==0||parseInt(a.substr(6,4))%100==0&&parseInt(a.substr(6,4))%4==0?/^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,ereg.test(a)?(a=(parseInt(b[0])+parseInt(b[10]))*7+(parseInt(b[1])+
parseInt(b[11]))*9+(parseInt(b[2])+parseInt(b[12]))*10+(parseInt(b[3])+parseInt(b[13]))*5+(parseInt(b[4])+parseInt(b[14]))*8+(parseInt(b[5])+parseInt(b[15]))*4+(parseInt(b[6])+parseInt(b[16]))*2+parseInt(b[7])*1+parseInt(b[8])*6+parseInt(b[9])*3,a="10X98765432".substr(a%11,1),a==b[17]?true:false):false;default:return false}}function t(){var a=z("source");a||(a=u("xd_source"));a&&l("xd_source",a,365,"/",".xd.com");return a}function A(a){k=null;d.ajax({url:j+"/users/logoutService",dataType:"jsonp",
success:function(){d.isFunction(a)?B(function(){a(k)}):B()}})}function C(a,b){a=d.trim(a);if(d.isFunction(b)){var c=false,e="2-20\u4e2a\u4e2d\u82f1\u6587\u6570\u5b57";n!=a?(n=a,a.length<2||a.length>20||!a.match(/^[\w_\u3300-\u9fff\uf900-\ufaff]{2,20}$/)?(o=c=false,p=e="2-20\u4e2a\u4e2d\u82f1\u6587\u6570\u5b57",b(h(c,e))):d.ajax({url:j+"/users/check_username",data:{username:a},dataType:"jsonp",success:function(a){switch(a.toString()){case "1":c=true;e="\u7528\u6237\u540d\u53ef\u7528";break;case "-1":c=
false;e="2-20\u4e2a\u4e2d\u82f1\u6587\u6570\u5b57";break;case "-3":c=false,e="\u7528\u6237\u540d\u5df2\u88ab\u6ce8\u518c"}o=c;p=e;b(h(c,e))}})):b(h(o,p))}}function D(a){a=d.trim(a);return a.length<6?h(false,"\u6700\u77ed6\u4f4d"):(s=a,h(true,"\u5bc6\u7801\u53ef\u7528"))}function E(a){a=d.trim(a);return a!=s?h(false,"\u5bc6\u7801\u4e0d\u4e00\u81f4"):h(true,"\u5bc6\u7801\u4e00\u81f4")}function F(a,b){a=d.trim(a);if(d.isFunction(b)){var c=false,e="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u5b50\u90ae\u7bb1\u5730\u5740";
a.length>6&&a.match(/^[A-Z0-9._%+\-]+@(?:[A-Z0-9\-]+\.)+[A-Z]{2,4}$/i)&&(c=true,e="\u90ae\u7bb1\u53ef\u7528");b(h(c,e))}}function G(a){a=d.trim(a);return/^[\u3300-\u9fff\uf900-\ufaff]{2,}$/.test(a)?h(true,"\u771f\u5b9e\u59d3\u540d"):h(false,"\u8bf7\u8f93\u5165\u771f\u5b9e\u59d3\u540d")}function H(a){a=d.trim(a);return L(a)?h(true,"\u6709\u6548\u8eab\u4efd\u8bc1"):h(false,"\u8bf7\u8f93\u5165\u6709\u6548\u8eab\u4efd\u8bc1")}function u(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var e=
b[c];e.charAt(0)==" ";)e=e.substring(1,e.length);if(e.indexOf(a)==0)return decodeURIComponent(e.substring(a.length,e.length))}return null}function l(a,b,c,e,d){if(a){var f="";c&&(f=new Date,f.setTime(f.getTime()+c*864E5),f="; expires="+f.toGMTString());document.cookie=a+"="+encodeURIComponent(b)+f+(";path="+(e||"/"))+(d?";domain="+d:"")}}function v(a,b,c){l(a,"",-100,b,c)}function z(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return a==
null?"":decodeURIComponent(a[1].replace(/\+/g," "))}function I(a,b,c,e,g){document.domain="xd.com";window.open(a,c||"open_window","width="+(e||500)+",height="+(g||350)+",menubar=0,scrollbars=1, resizable=1,status=1,titlebar=0,toolbar=0,location=0");window.child_close_handler=function(a){a&&l("xd[user]",a,30,"/",".xd.com");d.isFunction(b)&&J(b)}}function J(a){d.ajax({url:j+"/users/sync_login",dataType:"jsonp",success:function(b){b&&d("body").append("<div>"+b+"</div>");d.isFunction(a)&&setTimeout(function(){try{a()}catch(b){}},
100)}})}function B(a){d.ajax({url:j+"/users/sync_logout",dataType:"jsonp",success:function(b){d("body").append("<div>"+b+"</div>");d.isFunction(a)&&setTimeout(function(){try{a()}catch(b){}},100)}})}var j="http://www.xd.com";window.location.host.indexOf("local.")==0?j="http://local.www.xd.com":window.location.host.indexOf("office.")>0&&(j="http://www.office.xd.com");var k=null,w=[],x=false;n=void 0;o=void 0;p=void 0;s=void 0;var y=[],d;typeof jQuery=="undefined"?K("http://web.xdcdn.net/xd/js/jquery.js",
function(){d=jQuery},true):d=jQuery;t();return{getUser:function(a,b,c){d.isFunction(a)&&(k?a(k):(b!="tdyx"&&b!="sxd"&&b!="sssg"&&(b=null),c!="verycd"&&(c=null),d.ajax({url:j+"/users/getuser",dataType:"jsonp",data:{app:b,site:c},cache:false,success:function(b){try{b&&b.id>0&&(k=b),a(b)}catch(c){}}})))},login:function(a,b,c,e,g,f,h,l){if(d.isFunction(e)&&d.isFunction(g)){if(k)if(k.username==a){e(k);return}else A();if(!x){x=true;var m=setTimeout("logging=false;",1E4),a=d.trim(a),b=d.trim(b);a?b?(h!=
"xd"&&h!="verycd"&&(h="xd"),f!="tdyx"&&f!="sxd"&&f!="sssg"&&(f=null),d.ajax({url:j+"/users/loginService",dataType:"jsonp",data:{"data[User][username]":a,"data[User][password]":b,"data[User][remember_me]":Boolean(c),"data[User][site]":h,app:f,captcha:l||null},cache:false,success:function(a){x=false;clearTimeout(m);if(a&&a.id>0)k=a,J(function(){e(k)});else try{g(a)}catch(b){}}})):g({error:"\u5bc6\u7801\u4e3a\u7a7a"}):g({error:"\u7528\u6237\u540d\u4e3a\u7a7a"})}}},logout:A,getServers:function(a,b){a&&
d.isFunction(b)&&(w[a]?b(w[a]):d.ajax({url:j+"/games/getservers/"+a,dataType:"jsonp",success:function(c){c&&(w[a]=c);b(c)}}))},getPlayUrl:function(a,b){if(!a)return false;var c=j+"/games/play?app="+a;b&&(c+="&server="+b);return c},checkUsername:C,checkPassword:D,checkConfirm:E,checkEmail:F,checkRealname:G,checkRealid:H,register:function(a,b,c,e,g,f,k,l){function m(m,p){if(o)if(p.valid){q[m]=true;for(i in q)if(!q[i])return;var r={username:a,password:b,confirm:c};if(e)r.email=e;if(g)r.realname=g;if(f)r.realid=
f;var n=t();if(n)r.source=n;d.ajax({url:j+"/users/registerService",success:function(a){a.user<=0?l(h(false,a.error)):(n&&v("xd_source","/",".xd.com"),k(a))},cache:false,data:r,dataType:"jsonp"})}else o=false,l(p)}a=d.trim(a);b=d.trim(b);c=d.trim(c);e=d.trim(e);g=d.trim(g);f=d.trim(f);if(d.isFunction(k)&&d.isFunction(l)){var q={username:false,password:false,confirm:false};if(e)q.email=false;if(g)q.realname=false;if(f)q.realid=false;var o=true;C(a,function(a){m("username",a)});m("password",D(b));m("confirm",
E(c));e&&F(e,function(a){m("email",a)});g&&m("realname",G(g));f&&m("realid",H(f))}},getCookie:u,setCookie:l,deleteCookie:v,clearCookie:function(a,b){for(var c=[],d=document.cookie.split(";"),g=0;g<d.length;g++){for(var f=d[g];f.charAt(0)==" ";)f=f.substring(1,f.indexOf("="));c.push(f)}for(g in c)v(c[g],a,b)},getSite:function(){value=u("uidsite");return value=="xd"||value=="verycd"?value:"xd"},setSite:function(a){a!="xd"&&a!="verycd"&&(a="xd");l("uidsite",a,3E3,"/",".xd.com")},bookmarkMe:function(a,
b){a=a||"http://www.com";b=b||"\u5fc3\u52a8\u6e38\u620f";window.sidebar?window.sidebar.addPanel(b,a,""):document.all?window.external.AddFavorite(a,b):alert("\u8bf7\u6309 Ctrl + D \u52a0\u5165\u6536\u85cf\u5939")},getParameterByName:z,capitaliseFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},setDomain:function(a){j=a},getPlayedHistory:function(a,b){a&&d.isFunction(b)&&(y[a]?b(y[a]):d.ajax({url:j+"/games/history/"+a,dataType:"jsonp",success:function(c){if(c){for(var d in c)c[d]=
c[d].UserPlayHistory;y[a]=c}b(c)}}))},getCaptchaUrl:function(){return j+"/security/captcha/"+Math.random()},qq_login:function(a){d.isFunction(a)||(a=function(){window.location.reload()});I(j+"/oauth/qq_login",a,"TencentLogin",694,600);return false},qq_redirect:function(a){if(!a)a=window.location.href;window.location.href=j+"/oauth/qq_redirect?return="+a},weibo_login:function(a){d.isFunction(a)||(a=function(){window.location.reload()});I(j+"/oauth/weibo_login",a,"WeiboLogin",585,422);return false},
getdomain:function(){return j},getSource:t}}();
